<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Path-bevegelse i landsby</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.121.0/examples/js/controls/OrbitControls.js"></script>
  </head>
  <body>
    <script>
      // ðŸ”§ Grunnoppsett
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0xa3d9ff);

      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.set(10, 15, 15);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      controls.maxPolarAngle = Math.PI / 2.1;
      controls.target.set(6, 0, 6);
      controls.update();

      scene.add(new THREE.AmbientLight(0xffffff, 0.6));
      const dirLight = new THREE.DirectionalLight(0xffffff, 1);
      dirLight.position.set(10, 20, 10);
      scene.add(dirLight);

      // ðŸŸ© Bakke + vei
      const gridSize = 12;
      const tileSize = 1;
      for (let x = 0; x < gridSize; x++) {
        for (let z = 0; z < gridSize; z++) {
          const isRoad = z === 5 || z === 6;
          const color = isRoad ? 0x888888 : 0x55aa55;
          const tile = new THREE.Mesh(
            new THREE.BoxGeometry(tileSize, 0.2, tileSize),
            new THREE.MeshStandardMaterial({ color })
          );
          tile.position.set(x, -0.1, z);
          scene.add(tile);
        }
      }

      // ðŸ“ Lag path (U-form)
      const pathPoints = [
        new THREE.Vector3(2, 0, 5.4),
        new THREE.Vector3(4, 0, 5.4),
        new THREE.Vector3(6, 0, 5.4),
        new THREE.Vector3(8, 0, 5.4),
        new THREE.Vector3(10, 0, 5.4),
        new THREE.Vector3(11, 0, 5.8),
        new THREE.Vector3(10, 0, 6.2),
        new THREE.Vector3(8, 0, 6.2),
        new THREE.Vector3(6, 0, 6.2),
        new THREE.Vector3(4, 0, 6.2),
        new THREE.Vector3(2, 0, 6.2),
        new THREE.Vector3(1, 0, 5.8),
        new THREE.Vector3(2, 0, 5.4),
      ];

      const curve = new THREE.CatmullRomCurve3(pathPoints, true);

      // ðŸ§â€â™‚ï¸ Lag personer som fÃ¸lger path
      const people = [];

      function createPerson(offset) {
        const mesh = new THREE.Mesh(
          new THREE.BoxGeometry(0.4, 0.8, 0.4),
          new THREE.MeshStandardMaterial({ color: 0xff5555 })
        );
        mesh.position.copy(curve.getPointAt(offset));
        scene.add(mesh);

        people.push({
          mesh,
          t: offset,
          speed: 0.0003 + Math.random() * 0.0002,
        });
      }

      createPerson(0.0);
      createPerson(0.25);
      createPerson(0.5);
      createPerson(0.75);

      // ðŸ  Enkle hus
      function createHouse(x, z) {
        const house = new THREE.Mesh(
          new THREE.BoxGeometry(0.8, 1, 0.8),
          new THREE.MeshStandardMaterial({ color: 0xaa6644 })
        );
        house.position.set(x + 0.5, 0.5, z + 0.5);
        scene.add(house);
      }

      for (let x = 2; x < 7; x++) {
        createHouse(x, 3);
        createHouse(x, 8);
      }

      // ðŸŒ² TrÃ¦r
      function createTree(x, z) {
        const trunk = new THREE.Mesh(
          new THREE.CylinderGeometry(0.1, 0.1, 0.5),
          new THREE.MeshStandardMaterial({ color: 0x8b5a2b })
        );
        trunk.position.set(x + 0.5, 0.25, z + 0.5);
        scene.add(trunk);

        const crown = new THREE.Mesh(
          new THREE.SphereGeometry(0.4, 8, 8),
          new THREE.MeshStandardMaterial({ color: 0x228822 })
        );
        crown.position.set(x + 0.5, 0.75, z + 0.5);
        scene.add(crown);
      }

      for (let x = 0; x < 10; x++) {
        createTree(x, 1);
        createTree(x, 10);
      }

      // ðŸ” Animate
      function animate() {
        requestAnimationFrame(animate);
        controls.update();

        // Flytt personene langs path
        people.forEach((person) => {
          person.t += person.speed;
          if (person.t > 1) person.t -= 1;
          const pos = curve.getPointAt(person.t);
          person.mesh.position.copy(pos);
        });

        renderer.render(scene, camera);
      }

      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="no">
  <head>
    <meta charset="UTF-8" />
    <title>Kaleidoskop – tegne og speil med musen</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        background: #181c24;
        overflow: hidden;
      }
      canvas {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        cursor: crosshair;
      }
      .hint {
        position: fixed;
        bottom: 22px;
        left: 50%;
        transform: translateX(-50%);
        color: #fff;
        font-family: sans-serif;
        opacity: 0.25;
        font-size: 1.1em;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <canvas id="kaleido"></canvas>
    <div class="hint">Tegn med musen – alt speiles i 8 segmenter!</div>
    <script>
      const canvas = document.getElementById("kaleido");
      const ctx = canvas.getContext("2d");
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      const SEGMENTS = 8; // Endre til f.eks 6, 12, 16 for andre mønstre!
      const center = () => [canvas.width / 2, canvas.height / 2];
      let drawing = false,
        prev = null;

      // Fin random pastellfarge
      function randomColor() {
        const h = Math.floor(Math.random() * 360);
        return `hsl(${h},72%,85%)`;
      }

      canvas.addEventListener("mousedown", (e) => {
        drawing = true;
        prev = getPolar(e);
      });
      canvas.addEventListener("mouseup", (e) => (drawing = false));
      canvas.addEventListener("mouseleave", (e) => (drawing = false));

      canvas.addEventListener("mousemove", (e) => {
        if (!drawing) return;
        const cur = getPolar(e);
        for (let i = 0; i < SEGMENTS; i++) {
          const angle = ((Math.PI * 2) / SEGMENTS) * i;
          drawSegment(prev, cur, angle, i % 2 === 0);
        }
        prev = cur;
      });

      // Konverter musposisjon til "polare" koordinater (r, vinkel) fra midten
      function getPolar(e) {
        const rect = canvas.getBoundingClientRect();
        const cx = canvas.width / 2,
          cy = canvas.height / 2;
        const x = e.clientX - rect.left,
          y = e.clientY - rect.top;
        const dx = x - cx,
          dy = y - cy;
        const r = Math.sqrt(dx * dx + dy * dy);
        let a = Math.atan2(dy, dx);
        return { r, a };
      }

      function drawSegment(p1, p2, baseAngle, mirror) {
        // Speil begge punkter
        let a1 = p1.a + baseAngle;
        let a2 = p2.a + baseAngle;
        if (mirror) {
          a1 = -p1.a + baseAngle;
          a2 = -p2.a + baseAngle;
        }
        const cx = canvas.width / 2,
          cy = canvas.height / 2;
        const x1 = cx + Math.cos(a1) * p1.r;
        const y1 = cy + Math.sin(a1) * p1.r;
        const x2 = cx + Math.cos(a2) * p2.r;
        const y2 = cy + Math.sin(a2) * p2.r;
        ctx.save();
        ctx.strokeStyle = randomColor();
        ctx.lineWidth = 3.7;
        ctx.lineCap = "round";
        ctx.shadowColor = "#fff";
        ctx.shadowBlur = 8;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
        ctx.restore();
      }

      // Automatisk fade ut gamle streker (kan fjernes for "permanent" kunst)
      function fadeOld() {
        ctx.save();
        ctx.globalAlpha = 0.07;
        ctx.fillStyle = "#181c24";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.restore();
        requestAnimationFrame(fadeOld);
      }
      fadeOld();
    </script>
  </body>
</html>
